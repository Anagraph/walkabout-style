global:
    #cycleway: { all: [ any: [kind_detail: [cycleway, track, path, pedestrian, footway, steps], cycleway: [sidepath, track, opposite_track], cycleway_left: [sidepath, track, opposite_track], cycleway_right: [sidepath, track, opposite_track]] }, not: { any: [cycleway: [lane, opposite, opposite_lane], cycleway_left: [lane, opposite, opposite_lane], cycleway_right: [lane, opposite, opposite_lane] ] ] }
    cycleway: { all: [ any: [ kind_detail: [cycleway, track, path, pedestrian, footway, steps], cycleway: [sidepath, track, opposite_track], cycleway_left: [sidepath, track, opposite_track], cycleway_right: [sidepath, track, opposite_track]], not: { any: [ cycleway: [lane, opposite, opposite_lane], cycleway_left: [lane, opposite, opposite_lane], cycleway_right: [lane, opposite, opposite_lane] ] } ] }
        # all:
        #     - any:
        #         - kind_detail: [cycleway, track, path, pedestrian, footway, steps]
        #         - cycleway: [sidepath, track, opposite_track]
        #         - cycleway_left: [sidepath, track, opposite_track]
        #         - cycleway_right: [sidepath, track, opposite_track]
        #     - not:
        #         any:
        #             - cycleway: [lane, opposite, opposite_lane]
        #             - cycleway_left: [lane, opposite, opposite_lane]
        #             - cycleway_right: [lane, opposite, opposite_lane]
    separated_bike_lanes_tracks_etc: { any: [ { oneway: yes, kind_detail: [cycleway, track, path, pedestrian, footway, steps] }, { oneway: yes, cycleway: [lane, track, opposite, opposite_lane, opposite_track] }, cycleway_left: [lane, track, opposite, opposite_lane, opposite_track], cycleway_right: [lane, track, opposite, opposite_lane, opposite_track] ] }
        # any:
        #     - { oneway: yes, kind_detail: [cycleway, track, path, pedestrian, footway, steps] }
        #     - { oneway: yes, cycleway: [lane, track, opposite, opposite_lane, opposite_track] }
        #     - cycleway_left: [lane, track, opposite, opposite_lane, opposite_track]
        #     - cycleway_right: [lane, track, opposite, opposite_lane, opposite_track]
        #     - { not: { kind_detail: [path, cycleway] } }
    left_or_right_or_implied: { any: [ cycleway_left: true, cycleway_right: true ,{ oneway: yes, cycleway: true } ,{ oneway: yes, kind_detail: true } ] }
        # any:
        #     - cycleway_left: true
        #     - cycleway_right: true
        #     - { oneway: yes, cycleway: true }
        #     - { oneway: yes, kind_detail: true }
    left_is_special: { any: [ cycleway_left: true, cycleway: opposite ] }
        # any:
        #     - cycleway_left: true
        #     - cycleway: opposite
    shared_lane: { any: [ cycleway: [shared_lane, shared], cycleway_left: [shared_lane, shared], cycleway_right: [shared_lane, shared]] }
        # any:
        #     - cycleway: [shared_lane, shared]
        #     - cycleway_left: [shared_lane, shared]
        #     - cycleway_right: [shared_lane, shared]
    cycle_track: { any: [ { kind_detail: true, cycleway: [track, opposite_track] }, cycleway_left: [track, opposite_track], cycleway_right: [track, opposite_track], kind_detail: [cycleway, path, pedestrian, footway, steps] ] }
        # any:
        #     - { kind_detail: true, cycleway: [track, opposite_track] }
        #     - cycleway_left: [track, opposite_track]
        #     - cycleway_right: [track, opposite_track]
        #     - kind_detail: [cycleway, path, pedestrian, footway, steps]

    draw_block_left_or_right_or_implied: { filter: global.left_or_right_or_implied, draw: { casing_left: { color: white }, casing_right: { visible: true, color: global.left_right_lane }}, left_is_special: { filter: global.left_is_special, draw: { casing_left: { visible: true, color: global.left_right_lane }, casing_right: { visible: false, color: white } } } }
        # left_or_right_or_implied:
        #     filter: global.left_or_right_or_implied
        #     draw:
        #         # lines:
        #         #     outline:
        #         #         color: [[12, [0.900,0.900,0.900]], [13, red]]
        #         casing_left:
        #             #order: 1000 # function() { return feature.sort_rank + 1; }
        #             #visible: true
        #             color: white
        #         casing_right:
        #             #order: 1000 # function() { return feature.sort_rank + 1; }
        #             visible: true
        #             color: blue
        #     left_is_special:
        #         filter: global.left_is_special
        #         draw:
        #             casing_left:
        #                 #order: 1000 # function() { return feature.sort_rank + 1; }
        #                 visible: true
        #                 color: blue
        #             casing_right:
        #                 #order: 1000 # function() { return feature.sort_rank + 1; }
        #                 visible: false
        #                 color: white
    draw_block_shared_yellow_lane: { filter: global.shared_lane, draw: { lines: { color: global.shared } } }
        # shared_lane:
        #     filter: global.shared_lane
        #     draw:
        #         lines:
        #             color: yellow


    # COLORS
    bike: [0.000,0.549,0.929] # blue is route #[0.137,0.584,0.812]
    bike_path: [0.000,0.565,0.345]
    bike_separate: [0.110,0.686,0.435] #green is safest
    left_right_lane: [0.414,0.940,0.607]
    # left_right_lane: [0.122,0.894,0.400]
    cycle: [0.000,0.680,0.385]
    cycle_path: [0.000,0.565,0.345]
    shared: [1.000,1.000,0.271] #not so safe, biking with cars, no dedicated lane


layers:
    roads:
        arrows:
            # oneway arrows and shields are distinct groups!
            filter: { oneway: yes, shield_text: false, $zoom: { min: 17 } }
            draw:
                oneway:
                    sprite: arrow
                    size: [[17, 7px], [18, 10px]]
                    placement: spaced
                    placement_spacing: [[17, 70px], [20, 175px]]
                    angle: auto
        highway:
            bike:
                filter:
                    is_bicycle_related: true
                draw:
                    lines:
                        color: [[8, global.bike], [10, global.bike], [11, [1.00,1.00,1.00]]]
                        outline:
                            color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike]]
                # bike signs, lanes, separated paths
                cycleway:
                    filter: global.cycleway
                    draw:
                        lines:
                            color: [[8, global.cycle], [10, global.cycle], [11, [1.00,1.00,1.00]]]
                            outline:
                                color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.cycle]]
                #separated facility
                separated_bike_lanes_tracks_etc:
                    filter: global.separated_bike_lanes_tracks_etc
                    draw:
                        lines:
                            color: [[8, global.bike_separate], [10, global.bike_separate], [11, [1.00,1.00,1.00]]]
                            outline:
                                color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_separate]]
                        casing_left:
                            visible: false
                            order: 486
                            color: [0.460,0.640,1.000]
                            width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 5px], [18, 5m], [19, 6m]]
                        casing_right:
                            visible: false
                            order: 486
                            color: white
                            width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 5px], [18, 5m], [19, 6m]]
                    left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                    # bicyle is in the car lanes
                    # seems like this is overkill for primary? mark for potential removal
                    # biking with cars - not so safe
                    shared_yellow_lane: global.draw_block_shared_yellow_lane
                    cycle_track:
                        filter: global.cycle_track
                        draw:
                            lines:
                                color: [[8, global.cycle], [10, global.cycle], [11, [1.00,1.00,1.00]]]
                                outline:
                                    color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.cycle]]
                shared_lane: global.draw_block_shared_yellow_lane
        major_road:
            trunk_primary:
                # anything bike related (unsigned routes, signed routes to full separated trails)
                bike:
                    filter:
                        is_bicycle_related: true
                    draw:
                        lines:
                            color: [[10, global.bike], [11, [1.00,1.00,1.00]]]
                            outline:
                                color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike]]
                    # bike signs, lanes, separated paths
                    cycleway:
                        filter: global.cycleway
                        draw:
                            lines:
                                color: [[10, global.cycle], [11, [1.00,1.00,1.00]]]
                                outline:
                                    color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.cycle]]
                    #separated facility
                    separated_bike_lanes_tracks_etc:
                        filter: global.separated_bike_lanes_tracks_etc
                        draw:
                            lines:
                                color: [[10, global.bike_separate], [11, [1.00,1.00,1.00]]]
                                outline:
                                    color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_separate]]
                            casing_left:
                                visible: false
                                order: 486
                                color: red #[0.460,0.640,1.000]
                                width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 5px], [18, 5m], [19, 6m]]
                            casing_right:
                                visible: false
                                order: 486
                                color: white
                                width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 5px], [18, 5m], [19, 6m]]
                        left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                        # bicyle is in the car lanes
                        # seems like this is overkill for primary? mark for potential removal
                        # biking with cars - not so safe
                        shared_yellow_lane: global.draw_block_shared_yellow_lane
                        cycle_track:
                            filter: global.cycle_track
                            draw:
                                lines:
                                    color: [[10, global.cycle], [11, [1.00,1.00,1.00]]]
                                    outline:
                                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.cycle]]
                    shared_lane: global.draw_block_shared_yellow_lane

                routes:
                    bike:
                        filter:
                            is_bicycle_related: true
                        draw:
                            lines:
                                color: [[8, global.bike], [10, global.bike], [11, [1.00,1.00,1.00]]]
                                outline:
                                    color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike], [14, global.bike]]

                        cycleway:
                            filter: global.cycleway
                            draw:
                                lines:
                                    color: [[8, global.cycle], [10, global.cycle], [11, [1.00,1.00,1.00]]]
                                    outline:
                                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.cycle], [14, global.cycle]]

                        separated_bike_lanes_tracks_etc:
                            filter: global.separated_bike_lanes_tracks_etc
                            draw:
                                lines:
                                    color: [[8, global.bike_separate], [10, global.bike_separate], [11, [1.00,1.00,1.00]]]
                                    outline:
                                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_separate], [14, global.bike_separate]]
                                casing_left:
                                    visible: false
                                    order: 486
                                    color: [0.460,0.640,1.000]
                                    width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 5px], [18, 5m], [19, 6m]]
                                casing_right:
                                    visible: false
                                    order: 486
                                    color: white
                                    width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 5px], [18, 5m], [19, 6m]]
                            left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                            shared_yellow_lane: global.draw_block_shared_yellow_lane
                            cycle_track:
                                filter: global.cycle_track
                                draw:
                                    lines:
                                        color: [[8, global.cycle], [10, global.cycle], [11, [1.00,1.00,1.00]]]
                                        outline:
                                            color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.cycle], [14, global.cycle]]
                        shared_lane: global.draw_block_shared_yellow_lane
            secondary:
                bike:
                    filter:
                        is_bicycle_related: true
                    draw:
                        lines:
                            outline:
                                color: [[9, [0.906,0.906,0.906]], [10, global.bike]]

                    cycleway:
                        filter: global.cycleway
                        draw:
                            lines:
                                outline:
                                    color: [[9, [0.906,0.906,0.906]], [10, global.cycle]]
                    separated_bike_lanes_tracks_etc:
                        filter: global.separated_bike_lanes_tracks_etc
                        draw:
                            lines:
                                outline:
                                    color: [[9, [0.906,0.906,0.906]], [10, global.bike_separate]]
                            casing_left:
                                visible: false
                                order: 486
                                color: [0.460,0.640,1.000]
                                width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 4px], [18, 5m], [19, 6m]]
                            casing_right:
                                visible: false
                                order: 486
                                color: white
                                width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 4px], [18, 5m], [19, 6m]]
                        left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                        shared_yellow_lane: global.draw_block_shared_yellow_lane
                        cycle_track:
                            filter: global.cycle_track
                            draw:
                                lines:
                                    outline:
                                        color: [[9, [0.906,0.906,0.906]], [10, global.cycle]]
                    shared_lane: global.draw_block_shared_yellow_lane

                routes:
                    bike:
                        filter:
                            is_bicycle_related: true
                        draw:
                            lines:
                                color: [[10, global.bike], [11, [1.00, 1.00, 1.00]]]
                                outline:
                                    color: [[9, [0.906,0.906,0.906]], [10, [0.906,0.906,0.906]], [11, global.bike], [14, global.bike]]

                        cycleway:
                            filter: global.cycleway
                            draw:
                                lines:
                                    color: [[10, global.cycle], [11, [1.00,1.00,1.00]]]
                                    outline:
                                        color: [[9, [0.906,0.906,0.906]], [10, [0.906,0.906,0.906]], [11, global.cycle], [14, global.cycle]]

                        separated_bike_lanes_tracks_etc:
                            filter: global.separated_bike_lanes_tracks_etc
                            draw:
                                lines:
                                    color: [[10, global.bike_separate], [11, [1.00,1.00,1.00]]]
                                    outline:
                                        color: [[9, [0.906,0.906,0.906]], [10, [0.906,0.906,0.906]], [11, global.bike_separate], [14, global.bike_separate]]
                                casing_left:
                                    visible: false
                                    order: 486
                                    color: [0.460,0.640,1.000]
                                    width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 4px], [18, 5m], [19, 6m]]
                                casing_right:
                                    visible: false
                                    order: 486
                                    color: white
                                    width: [[12, 0.5px], [14, 1.5px], [15, 2px], [16, 3px], [17, 4px], [18, 5m], [19, 6m]]
                            left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                            shared_yellow_lane: global.draw_block_shared_yellow_lane
                            cycle_track:
                                filter: global.cycle_track
                                draw:
                                    lines:
                                        color: [[10, global.cycle], [11, [1.00,1.00,1.00]]]
                                        outline:
                                            color: [[9, [0.906,0.906,0.906]], [10, [0.906,0.906,0.906]], [11, global.cycle], [14, global.cycle]]
                        shared_lane: global.draw_block_shared_yellow_lane

            tertiary:
                bike:
                    filter:
                        is_bicycle_related: true
                    draw:
                        lines:
                            outline:
                                color: [[11, [0.847,0.822,0.826]], [12, global.bike]]

                    cycleway:
                        filter: global.cycleway
                        draw:
                            lines:
                                outline:
                                    color: [[11, [0.847,0.822,0.826]], [12, global.cycle]]

                    separated_bike_lanes_tracks_etc:
                        filter: global.separated_bike_lanes_tracks_etc
                        draw:
                            lines:
                                outline:
                                    color: [[11, [0.847,0.822,0.826]], [12, global.bike_separate]]
                            casing_left:
                                visible: false
                                order: 486
                                color: [0.460,0.640,1.000]
                                width: [[13, 1px], [14, 1.5px], [15, 2px], [16, 3px], [17, 4px], [18, 5m], [19, 6m]]
                            casing_right:
                                visible: false
                                order: 486
                                color: white
                                width: [[13, 1px], [14, 1.5px], [15, 2px], [16, 3px], [17, 4px], [18, 5m], [19, 6m]]
                        left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                        shared_yellow_lane: global.draw_block_shared_yellow_lane
                        cycle_track:
                            filter: global.cycle_track
                            draw:
                                lines:
                                    outline:
                                        color: [[11, [0.847,0.822,0.826]], [12, global.cycle]]
                    shared_lane: global.draw_block_shared_yellow_lane
        minor_road:
            bike:
                filter:
                    is_bicycle_related: true
                draw:
                    lines:
                        color: [[12, global.bike], [13, [1.00,1.00,1.00]]]
                        width: [[11, 0px], [12, 0.75px], [13, 0.15px], [14, 1px], [16, 3px], [18, 9m]]
                        outline:
                            color: [[12, [0.900,0.900,0.900]], [13, global.bike]]
                            width: [[11, 0px], [12, 0px], [13, 0.4px], [14, 1px], [16, 1.5px], [17, 2px], [18, 3px]]

                cycleway:
                    filter:
                        all:
                            - any:
                                - kind_detail: [cycleway, track, path, pedestrian, footway, steps]
                                - cycleway: [sidepath, track, opposite_track]
                                - cycleway_left: [sidepath, track, opposite_track]
                                - cycleway_right: [sidepath, track, opposite_track]
                            - not:
                                any:
                                    - cycleway: [lane, opposite, opposite_lane]
                                    - cycleway_left: [lane, opposite, opposite_lane]
                                    - cycleway_right: [lane, opposite, opposite_lane]
                    draw:
                        lines:
                            outline:
                                color: [[12, [0.900,0.900,0.900]], [13, global.cycle]]

                separated_bike_lanes_tracks_etc:
                    filter:
                        any:
                            - { oneway: yes, kind_detail: [cycleway, track, path, pedestrian, footway, steps] }
                            - { oneway: yes, cycleway: [lane, track, opposite, opposite_lane, opposite_track] }
                            - cycleway_left: [lane, track, opposite, opposite_lane, opposite_track]
                            - cycleway_right: [lane, track, opposite, opposite_lane, opposite_track]
                            - { not: { kind_detail: [path, cycleway] } }
                    draw:
                        lines:
                            outline: 
                                color: [[12, [0.900,0.900,0.900]], [13, global.bike_separate]]
                        casing_left:
                            visible: false
                            order: 486
                            color: [0.460,0.640,1.000]
                            width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 5m], [19, 6m]]
                        casing_right:
                            visible: false
                            order: 486
                            color: white
                            width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 5m], [19, 6m]]
                    left_or_right_or_implied:
                        filter:
                            any:
                                - cycleway_left: true
                                - cycleway_right: true
                                - { oneway: yes, cycleway: true }
                                - { oneway: yes, kind_detail: true }
                        draw:
                            # lines:
                            #     outline:
                            #         color: [[12, [0.900,0.900,0.900]], [13, red]]
                            casing_left:
                                color: white
                            casing_right:
                                visible: true
                                color: global.left_right_lane
                        left_is_special:
                            filter: 
                                any:
                                    - cycleway_left: true
                                    - cycleway: opposite
                            draw:
                                casing_left:
                                    visible: true
                                    color: global.left_right_lane
                                casing_right:
                                    visible: false
                                    color: white
                    shared_yellow_lane: 
                        filter: 
                            any:
                                - cycleway: [shared_lane, shared]
                                - cycleway_left: [shared_lane, shared]
                                - cycleway_right: [shared_lane, shared]
                        draw:
                            lines:
                                color: [[12, global.bike_separate], [13, yellow]]
                                width: [[11, 0px], [12, 0.75px], [13, 0.15px], [14, 1px], [16, 3px], [18, 9m]]
                                outline:
                                    color: [[12, [0.900,0.900,0.900]], [13, global.bike_separate]]
                                    width: [[11, 0px], [12, 0px], [13, 0.4px], [14, 1px], [16, 1.5px], [17, 2px], [18, 3px]]
                    cycle_track:
                        filter: global.cycle_track
                        draw:
                            lines:
                                outline:
                                    color: [[12, [0.900,0.900,0.900]], [13, global.cycle]]
                shared_lane: 
                    filter:
                        any:
                            - cycleway: [shared_lane, shared]
                            - cycleway_left: [shared_lane, shared]
                            - cycleway_right: [shared_lane, shared]
                    draw:
                        lines:
                            color: yellow
            bicycle-no:
                filter: 
                    bicycle: no
                draw:
                    lines:
                        color: [[12, red], [13, [1.00,1.00,1.00]]]
                        width: [[11, 0px], [12, 0.75px], [13, 0.15px], [14, 1px], [16, 3px], [18, 9m]]
                        outline:
                            color: [[12, [0.900,0.900,0.900]], [13, red]]
                            width: [[11, 0px], [12, 0px], [13, 0.4px], [14, 1px], [16, 1.5px], [17, 2px], [18, 3px]]

        path:

            paths:
                bike:
                    filter:
                        is_bicycle_related: true
                    draw:
                        lines:
                            outline:
                                color: [[12, [0.900,0.900,0.900]], [13, global.bike]]

                    cycleway:
                        filter: global.cycleway
                        draw:
                            lines:
                                outline:
                                    color: [[12, [0.900,0.900,0.900]], [13, global.cycle_path]]

                    separated_bike_lanes_tracks_etc:
                        filter: global.separated_bike_lanes_tracks_etc
                        draw:
                            lines:
                                outline: 
                                    color: [[12, [0.900,0.900,0.900]], [13, global.bike_separate]]
                            casing_left:
                                visible: false
                                order: 486
                                color: [0.460,0.640,1.000]
                                width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                            casing_right:
                                visible: false
                                order: 486
                                color: white
                                width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                        left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                        shared_yellow_lane: global.draw_block_shared_yellow_lane
                        cycle_track:
                            filter: global.cycle_track
                            draw:
                                lines:
                                    outline:
                                        color: [[12, [0.900,0.900,0.900]], [13, green]]
                    shared_lane: global.draw_block_shared_yellow_lane
                bicycle-no:
                    filter: 
                        bicycle: no
                    draw:
                        lines:
                            outline:
                                color: [[12, [0.900,0.900,0.900]], [13, red]]

            footway:
                bike:
                    filter:
                        is_bicycle_related: true
                    draw:
                        lines:
                            outline:
                                color: [[12, [0.900,0.900,0.900]], [13, global.bike]]

                    cycleway:
                        filter: global.cycleway
                        draw:
                            lines:
                                outline:
                                    color: [[12, [0.900,0.900,0.900]], [13, global.cycle_path]]

                    separated_bike_lanes_tracks_etc:
                        filter: global.separated_bike_lanes_tracks_etc
                        draw:
                            lines:
                                outline: 
                                    color: [[12, [0.900,0.900,0.900]], [13, global.bike_separate]]
                            casing_left:
                                visible: false
                                order: 486
                                color: [0.460,0.640,1.000]
                                width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                            casing_right:
                                visible: false
                                order: 486
                                color: white
                                width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                        left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                        shared_yellow_lane: global.draw_block_shared_yellow_lane
                        cycle_track:
                            filter: global.cycle_track
                            draw:
                                lines:
                                    outline:
                                        color: [[12, [0.900,0.900,0.900]], [13, green]]
                    shared_lane: global.draw_block_shared_yellow_lane
                bicycle-no:
                    filter: 
                        bicycle: no
                    draw:
                        lines:
                            outline:
                                color: [[12, [0.900,0.900,0.900]], [13, red]]

            pedestrian:
                bike:
                    filter:
                        is_bicycle_related: true
                    draw:
                        lines:
                            color: [[12, global.bike], [13, global.bike], [14, [1.00,1.00,1.00]]]
                            width: [[12, 0.75px], [13, 1px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
                            outline:
                                color: [[12, [0.900,0.900,0.900]], [13, global.bike]]
                                width: [[13, 0px], [14, 0.6px], [15, 1px], [17, 2px], [18, 3px]]

                    cycleway:
                        filter: global.cycleway
                        draw:
                            lines:
                                outline:
                                    color: [[12, [0.900,0.900,0.900]], [13, global.cycle_path]]

                    separated_bike_lanes_tracks_etc:
                        filter: global.separated_bike_lanes_tracks_etc
                        draw:
                            lines:
                                outline: 
                                    color: [[12, [0.900,0.900,0.900]], [13, global.bike_separate]]
                            casing_left:
                                visible: false
                                order: 486
                                color: [0.460,0.640,1.000]
                                width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                            casing_right:
                                visible: false
                                order: 486
                                color: white
                                width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                        left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                        shared_yellow_lane: global.draw_block_shared_yellow_lane
                        cycle_track:
                            filter: global.cycle_track
                            draw:
                                lines:
                                    outline:
                                        color: [[12, [0.900,0.900,0.900]], [13, green]]
                    shared_lane: global.draw_block_shared_yellow_lane

        track:
            bike:
                filter:
                    is_bicycle_related: true
                draw:
                    lines:
                        outline:
                            color: [[12, [0.900,0.900,0.900]], [13, global.bike]]

                cycleway:
                    filter: global.cycleway
                    draw:
                        lines:
                            outline:
                                color: [[12, [0.900,0.900,0.900]], [13, global.cycle_path]]

                separated_bike_lanes_tracks_etc:
                    filter: global.separated_bike_lanes_tracks_etc
                    draw:
                        lines:
                            outline: 
                                color: [[12, [0.900,0.900,0.900]], [13, global.bike_separate]]
                        casing_left:
                            visible: false
                            order: 486
                            color: [0.460,0.640,1.000]
                            width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                        casing_right:
                            visible: false
                            order: 486
                            color: white
                            width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                    left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                    shared_yellow_lane: global.draw_block_shared_yellow_lane
                    cycle_track:
                        filter: global.cycle_track
                        draw:
                            lines:
                                outline:
                                    color: [[12, [0.900,0.900,0.900]], [13, green]]
                shared_lane: global.draw_block_shared_yellow_lane

        other-roads-no-motorvehicle-overlay:
            bike:
                filter:
                    is_bicycle_related: true
                draw:
                    lines:
                        outline:
                            color: [[12, [0.900,0.900,0.900]], [13, global.bike]]

                cycleway:
                    filter: global.cycleway
                    draw:
                        lines:
                            outline:
                                color: [[12, [0.900,0.900,0.900]], [13, global.cycle]]

                separated_bike_lanes_tracks_etc:
                    filter: global.separated_bike_lanes_tracks_etc
                    draw:
                        lines:
                            outline: 
                                color: [[12, [0.900,0.900,0.900]], [13, global.bike_separate]]
                        casing_left:
                            visible: false
                            order: 486
                            color: [0.460,0.640,1.000]
                            width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                        casing_right:
                            visible: false
                            order: 486
                            color: white
                            width: [[13, 0px], [14, 1px], [15, 2px],[16, 3px],[17, 6px],[18, 9m],[19, 9m]]
                    left_or_right_or_implied: global.draw_block_left_or_right_or_implied
                    shared_yellow_lane: global.draw_block_shared_yellow_lane
                    cycle_track:
                        filter: global.cycle_track
                        draw:
                            lines:
                                outline:
                                    color: [[12, [0.900,0.900,0.900]], [13, green]]
                shared_lane: global.draw_block_shared_yellow_lane

        labels-cycleway:
            filter: 
                all:
                    - $zoom: { min: 17 }
                    - is_bicycle_related: true
            draw:
                text:
                    priority: 58
                    interactive: true
                    text_source: |
                        function() {
                            if( (feature.kind_detail == 'cycleway' && feature.cycleway == 'sidepath' || feature.cycleway == 'segregated') || 
                                (feature.kind_detail == 'footway'  && feature.bicycle == 'yes' && feature.segregated == 'yes' ) 
                            ) {
                                return "Sidepath"; 
                            } else if( feature.kind_detail == "cycleway" && feature.cycleway != 'sidepath' ) { 
                                return "Bike path";
                            } else if( feature.kind_detail == "footway" && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) { 
                                return "Designated footway";
                            } else if( feature.kind_detail == "steps" && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) { 
                                return "Designated steps";
                            } else if( feature.kind_detail == 'track' && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) {
                                return "Designated track";
                            } else if( feature.kind_detail == 'pedestrian' ) {
                                return "Designated pedestrian"; 
                            } else if( feature.kind == 'path' && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) {
                                return "Designated path"; 
                            } else if( feature.cycleway && feature.oneway == 'yes' ) {
                                return feature.cycleway + " (implied right)";
                            } else if( feature.cycleway ) {
                                return feature.cycleway + " (both sides)"; 
                            } else if( feature.cycleway_left && feature.cycleway_right ){ 
                                return feature.cycleway_left + " (left) & " + feature.cycleway_right + " (right)";
                            } else if( feature.cycleway_left ){ 
                                return feature.cycleway_left + " (left side)";
                            } else if ( feature.cycleway_right ){ 
                                return feature.cycleway_right + " (right side)"; 
                            } else { 
                                return "Designated route only";
                            }
                        }
                    font:
                        fill: blue #[0.143,0.544,0.481]
                        style: italic
                        size: 12px
                        stroke: { color: white, width: 4 }




#     bicycle-roads:
#         data: { source: mapzen, layer: roads }
#         filter: 
#             all:
#                 - $zoom: { min: 11 }
#             any:
#                 - is_bicycle_related: true
#                 # 20160520 nvkelso: this is a hack as we're not calculating is_bicycle_related inclusive of bicycle=*
#                 - bicycle: [yes, designated]
#                 # 20160520 nvkelso: this is a hack as we don't currently export bicycle=* on pedestrian ways
#                 - kind_detail: pedestrian
#         draw:
#             lines:
#                 interactive: true
#                 color: [0.231,0.412,0.996]
#                 width: [[11,1px],[15,1.75px],[16,0.01px]]
#                 # let roads sort themselves past zoom 14
#                 order: 490
#                 outline:
#                     order: 486
#                     color: [0.182,0.593,0.730]
#                     width: [[15, 0px],[16, 0.5px],[17, 1px]]
# #        early:
# #            filter:
# #                all:
# #                    - $zoom: [11]
# #                    - bicycle_network: [lcn]
# #                    - not:
# #                        - kind: path
# #            draw:
# #                lines:
# #                    visible: false
# #                    #color: red

#         cycleway-path-early:
#             filter: 
#                 all:
#                     - $zoom: { max: 16 }
#                     - any:
#                         - kind_detail: [cycleway, track, path, pedestrian, footway, steps]
#                         - cycleway: [sidepath, track, opposite_track]
#                         - cycleway_left: [sidepath, track, opposite_track]
#                         - cycleway_right: [sidepath, track, opposite_track]
#                     - not:
#                         any:
#                             - cycleway: [lane, opposite, opposite_lane]
#                             - cycleway_left: [lane, opposite, opposite_lane]
#                             - cycleway_right: [lane, opposite, opposite_lane]
#             draw:
#                 lines:
#                     color: '#02c014' #'#99ce9c'
# #                early-z15:
# #                    filter: { $zoom: [14,15] }
# #                    draw:
# #                        lines:
# #                            color: '#54b356'
#             track:
#                 filter: { kind_detail: track }
#                 draw:
#                     lines:
#                         color: '#cfbe99'
#                 early-z15:
#                     filter: { $zoom: [14,15] }
#                     draw:
#                         lines:
#                             color: '#b39654'
#             sidepath-z15:
#                 filter: 
#                     - cycleway: [sidepath]
#                     - cycleway_left: [sidepath]
#                     - cycleway_right: [sidepath]
#                 draw:
#                     lines:
#                         width: [[11, 1px], [12, 1.2px], [13, 1.0px],[14,1.2px],[15,1.5px],[16,0.01px]]
#         tracks-early:
#             filter: 
#                  all:
#                     - not: { kind_detail: [cycleway, track, path, pedestrian, footway, steps] }
#                     - $zoom: [14,15]
#                  any:
#                     - cycleway: [track, opposite_track]
#                     - cycleway_left: [track, opposite_track]
#                     - cycleway_right: [track, opposite_track]
#             draw:
#                 lines:
#                     width: 2.2px
#         separated_bike_lanes-etc-early:
#             filter: 
#                  all:
#                     - not: { kind_detail: [cycleway, track, path, pedestrian, footway, steps] }
#                     - $zoom: [14,15]
#                  any:
#                     - cycleway: [lane, opposite, opposite_lane]
#                     - cycleway_left: [lane, opposite, opposite_lane]
#                     - cycleway_right: [lane, opposite, opposite_lane]
#                     - bicycle: [yes, designated]
#             draw:
#                 lines:
#                     color: '#3b69fe'
#                     width: 2.2px
#         labels-cycleway:
#             filter: { $zoom: { min: 17 } }
#             draw:
#                 text-blend-order:
#                     priority: 58
#                     interactive: true
#                     text_source: |
#                         function() {
#                             if( (feature.kind_detail == 'cycleway' && feature.cycleway == 'sidepath' || feature.cycleway == 'segregated') || 
#                                 (feature.kind_detail == 'footway'  && feature.bicycle == 'yes' && feature.segregated == 'yes' ) 
#                             ) {
#                                 return "Sidepath"; 
#                             } else if( feature.kind_detail == "cycleway" && feature.cycleway != 'sidepath' ) { 
#                                 return "Bike path";
#                             } else if( feature.kind_detail == "footway" && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) { 
#                                 return "Designated footway";
#                             } else if( feature.kind_detail == "steps" && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) { 
#                                 return "Designated steps";
#                             } else if( feature.kind_detail == 'track' && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) {
#                                 return "Designated track";
#                             } else if( feature.kind_detail == 'pedestrian' ) {
#                                 return "Designated pedestrian"; 
#                             } else if( feature.kind == 'path' && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) {
#                                 return "Designated path"; 
#                             } else if( feature.cycleway && feature.oneway == 'yes' ) {
#                                 return feature.cycleway + " (implied right)";
#                             } else if( feature.cycleway ) {
#                                 return feature.cycleway + " (both sides)"; 
#                             } else if( feature.cycleway_left && feature.cycleway_right ){ 
#                                 return feature.cycleway_left + " (left) & " + feature.cycleway_right + " (right)";
#                             } else if( feature.cycleway_left ){ 
#                                 return feature.cycleway_left + " (left side)";
#                             } else if ( feature.cycleway_right ){ 
#                                 return feature.cycleway_right + " (right side)"; 
#                             } else { 
#                                 return "Designated route only";
#                             }
#                         }
#                     font:
#                         fill: blue #[0.143,0.544,0.481]
#                         style: italic
#                         size: 12px
#                         stroke: { color: white, width: 4 }
#         double-lines:
#             filter: { $zoom: { min: 16 } }
#             draw:
#                 lines:
#                     color: [[16,[1.00,1.00,1.00]], [17,'#dbe6f9']]
#                     width: [[15,0px],[16,1.5px],[17,4px],[18,6m]]
#                     outline:
#                         color: [0.000,0.502,0.855]#[0.460,0.640,1.000]
#                         width: [[15, 0.5px],[16, 1.5px],[17, 1.5px],[18, 2.5px],[19, 1m]]
#                 casing_left:
#                     visible: false
#                     interactive: true
#                     order: 486
#                     color: [0.460,0.640,1.000]
#                     width: [[15, 0.5px],[16, 5.5px],[17, 10px],[18, 9m],[19, 8m]]
#                 casing_right:
#                     visible: false
#                     interactive: true
#                     order: 486
#                     color: white
#                     width: [[15, 0.5px],[16, 6px],[17, 10px],[18, 9m],[19, 8m]]
#             labels-early:
#                 filter: { $zoom: [16] }
#                 draw:
#                     text-blend-order:
#                         visible: false
#             # label bike-path
#             cycleway-path:
#                 filter: 
#                     any:
#                         - { kind_detail: cycleway }
#                         - { kind_detail: path, bicycle: [designated, yes] }
#                         - { kind_detail: track, bicycle: [designated, yes] }
#                         - { kind_detail: footway, bicycle: [designated, yes] }
#                         - { kind_detail: steps, bicycle: [designated, yes] }
#                         - { cycleway: [track, opposite_track] }
#                         - { kind_detail: pedestrian }
#                     not:
#                         - { kind_detail: footway, bicycle: yes, segregated: yes, cycleway: [sidepath] }
#                 draw:
#                     lines:
#                         order: 486
#                         color: [0.450,1.000,0.505] #'#02c014' #'#99ce9c'
#                         outline:
#                             color: [[16,'#54b356'],[17,'#3ba53d'],[18,green]]
#                     text-blend-order:
#                         font:
#                             fill: green
#                 # label - track(both sides)
#                 cycleway_tracks:
#                     filter: { cycleway: [track, opposite_track], oneway: false }
#                     draw:
#                         lines:
#                             color: [0.789,1.000,0.450] #'#afdcb2'
#                 footway_steps:
#                     filter: { kind_detail: [footway, steps] }
#                     draw:
#                         lines:
#                             color: '#afdcb2'
#                             width: [[15,0px],[16,0.6px],[17,2.0px],[18,3m]]
#                             outline:
#                                 color: [[16,'#6abe6c'],[17,'#5cb65e']]
#                                 width: [[15, 0.5px],[16, 1.5px],[17, 1px],[18, 2px],[19, 0.7m]]
#                     steps:
#                         filter: { kind_detail: steps }
#                         draw:
#                             lines:
#                                 color: '#eac6c6'
#                                 outline:
#                                     color: [[16,'#bf6b6b'],[17,'#b04d4d']]
#                             text-blend-order:
#                                 font:
#                                     fill: '#b04d4d'
#                 tracks:
#                     filter: { kind_detail: track }
#                     draw:
#                         lines:
#                             order: 487
#                             color: '#cebe99'
#                             outline:
#                                 color: [[16,'#b39654'],[17,'#a6863c'],[18,'#826219']]
#                         text-blend-order:
#                             font:
#                                 fill: '#826219'
#             separated_bike_lanes_tracks_etc:
#                 filter: 
# #                     all:
# #                        - not: { kind_detail: [cycleway, track, path, pedestrian, footway, steps] }
#                      any:
#                         - { oneway: yes, kind_detail: [cycleway, track, path, pedestrian, footway, steps] }
#                         - { oneway: yes, cycleway: [lane, track, opposite, opposite_lane, opposite_track] }
#                         - cycleway_left: [lane, track, opposite, opposite_lane, opposite_track]
#                         - cycleway_right: [lane, track, opposite, opposite_lane, opposite_track]
#                         - { bicycle: [yes, designated], not: { kind_detail: [path, cycleway] } }
#                 draw:
#                     lines:
#                         outline:
#                             order: 488
#                             color: blue
#                     casing_left:
#                         color: white
#                     casing_right:
#                         color: blue
#                 left_or_right_or_implied:
#                     filter:
#                         any:
#                             - cycleway_left: true
#                             - cycleway_right: true
#                             - { oneway: yes, cycleway: true }
#                             - { oneway: yes, kind_detail: true }
#                     draw:
#                         lines:
#                             color: [[16,'#dbe6f9'], [17,'#dbe6f9']]
#                             width: [[15,1px],[16,3px],[17,6.5px],[18,6m]]
#                             outline:
#                                 visible: false
#                                 width: 0px
#                         casing_left:
#                             visible: true
#                         casing_right:
#                             visible: true
#                     left_is_special:
#                         filter:
#                             any:
#                                 - cycleway_left: true
#                                 - cycleway: opposite
#                         draw:
#                             casing_left:
#                                 color: blue
#                             casing_right:
#                                 color: white
#                         omg_oneway_bicycle:
#                             filter: { cycleway: [opposite, opposite_lane], oneway_bicycle: no }
#                             draw:
#                                 casing_right:
#                                     color: blue
#                     shared_lane:
#                         filter:
#                              any:
#                                 - cycleway: [shared_lane, shared]
#                                 - cycleway_left: [shared_lane, shared]
#                                 - cycleway_right: [shared_lane, shared]
#                         draw:
#                             lines:
#                                 color: '#fffbca'
#                             casing_right:
#                                 color: [0.460,0.640,1.000]
#                     cycle_track:
#                         filter:
#                              any:
#                                 - { kind_detail: true, cycleway: [track, opposite_track] }
#                                 - cycleway_left: [track, opposite_track]
#                                 - cycleway_right: [track, opposite_track]
#                                 - kind_detail: [cycleway, path, pedestrian, footway, steps]
#                         draw:
#                             lines:
#                                 color: '#afdcb2'
#                                 order: 492
#                             casing_right:
#                                 color: '#02c014' #[[16,'#54b356'],[17,'#3ba53d'],[18,green]]
#                             text-blend-order:
#                                 font:
#                                     fill: green
#                         cycleway_left:
#                             filter: 
#                                 - cycleway_left: true
#                             draw:
#                                 casing_left:
#                                     color: '#02c014' #[[16,'#54b356'],[17,'#3ba53d'],[18,green]]
#                                 casing_right:
#                                     color: white
#                         # sometimes there are also lanes on the other side
#                         cycleway_left_lane:
#                             filter:
#                                 - cycleway_left: [lane, opposite, opposite_lane]
#                             draw:
#                                 casing_left:
#                                     color: blue
#                                 casing_right:
#                                     color: '#02c014'
#                     track_track:
#                         filter:
#                              any:
#                                 - kind_detail: [track]
#                         draw:
#                             lines:
#                                 color: '#afdcb2'
#                             casing_right:
#                                 color: brown #'#00c445' #[[16,'#54b356'],[17,'#3ba53d'],[18,green]]
#                             text-blend-order:
#                                 font:
#                                     fill: brown
#                         cycleway_left:
#                             filter: 
#                                 - cycleway_left: true
#                             draw:
#                                 casing_left:
#                                     color: brown #'#00c445' #[[16,'#54b356'],[17,'#3ba53d'],[18,green]]
#                                 casing_right:
#                                     color: white

#             lane:
#                 filter:
#                      any:
#                         - cycleway: [lane, opposite, opposite_lane]
#                         - cycleway_left: [lane, opposite, opposite_lane]
#                         - cycleway_right: [lane, opposite, opposite_lane]
#                 draw:
#                     lines:
#                         outline:
#                             color: blue
#             shared_lane:
#                 filter:
#                      any:
#                         - cycleway: [shared_lane, shared]
#                         - cycleway_left: [shared_lane, shared]
#                         - cycleway_right: [shared_lane, shared]
#                 draw:
#                     lines:
#                         order: 489
#                         color: '#fffbca'
#                     text-blend-order:
#                         font:
#                             stroke:
#                                 color: '#fffbca'
#             sidepath:
#                 filter:
#                     any:
#                         - cycleway: [sidepath, segregated]
#                         - cycleway_left: [sidepath, segregated]
#                         - cycleway_right: [sidepath, segregated]
#                         - { kind_detail: footway, bicycle: yes, segregated: yes }
#                 draw:
#                     lines:
#                         order: 491
#                         width: [[15,0px],[16,0.6px],[17,2.5px],[18,2.5m]]
#                         color: '#afdcb2'
#                         outline:
#                             color: [[16,'#6abe6c'],[17,'#5cb65e']]
#                             width: [[15, 0.5px],[16, 1.0px],[17, 1px],[18, 2px],[19, 0.7m]]
#                     text-blend-order:
#                         font:
#                             fill: green


textures:
    oneway:
        url: ../images/arrow.png
    # oneway:
    #     url: https://raw.githubusercontent.com/tangrams/tangram/9eb952b84cf3d6bb5aa95eaf249e6871172a0b17/demos/images/pois.png
    #     filtering: mipmap
    #     sprites:
    #         # define sprites: [x origin, y origin, width, height]
    #         # plane: [0, 0, 32, 32]
    #         # tree: [0, 185, 32, 32]
    #         # sunburst: [0, 629, 32, 32]
    #         # restaurant: [0, 777, 32, 32]
    #         # cafe: [0, 814, 32, 32]
    #         # museum: [0, 518, 32, 32]
    #         # bar: [0, 887, 32, 32]
    #         # train: [0, 74, 32, 32]
    #         # bus: [0, 148, 32, 32]
    #         # hospital: [0, 444, 32, 32]
    #         # parking: [0, 1073, 32, 32]
    #         # info: [0, 1110, 32, 32]
    #         # hotel: [0, 259, 32, 32]
    #         # bookstore: [0, 333, 32, 32]
    #         # shield: [0, 1142, 32, 32]
    #         arrow: [1, 1175, 22, 22]


styles:
    oneway:
        base: points
        texture: oneway
    casing_left:
        mix: casing_right
        shaders:
            uniforms:
                FLIP: true
    casing_right:
        base: lines
        texcoords: true
        shaders:
            uniforms:
                FLIP: false
                LINE_WIDTH:  0.0001
                SPIKE_WIDTH: 1.
                SPIKE_SCALE: 2.
            blocks:
                global: |
                    float pulse(float x,float p, float w){
                        x = abs(x - p);
                        if( x>w ) return 0.0;
                        x /= w;
                        return 1.0 - x*x*(3.0-2.0*x);
                    }
                color: |
                    vec2 st = v_texcoord.xy;
                    if (FLIP) {
                        st.x = 1. - st.x;
                    }
                    float pattern = step(.5,  pulse(st.x,0.5,LINE_WIDTH) + pulse(st.x,0.146,LINE_WIDTH));
                    pattern += (step(.5,st.x))*pulse(fract(st.y*SPIKE_SCALE),.1,SPIKE_WIDTH);
                    if (pattern==0.) {
                        discard;
                    }