# tier1
    # tier1a: off-road paths (no cars) -- green on SF Bike Map, solid "black" on Google
    # tier1b: off-road dirt track (no cars) -- green on SF Bike Map, solid "brown" on Google
# tier2: on-road painted lanes (next to cars) -- orange on SF Bike Map, solid green on Google
# tier3: on-road "route" signage (with cars) -- blue on SF Bike Map, dashed green on Google
# tier4: bike prohibited -- red for us

layers:
    # todo: make special color bike shop icon, hide other icons early
    roads:
        highway:
            bike: global.bike_draw_highway

        major_road:
            trunk_primary:
                bike: global.bike_draw_trunk_primary
                routes:
                    bike: global.bike_draw_trunk_primary
                labels-trunk_primary-z11-up:
                    bike_labels: global.bike_draw_labels


            secondary:
                bike: global.bike_draw_secondary
                routes:
                    bike: global.bike_draw_secondary
                labels-secondary:
                    bike_labels: global.bike_draw_labels

            tertiary:
                bike: global.bike_draw_tertiary
                routes:
                    bike: global.bike_draw_tertiary
                labels-tertiary:
                    bike_labels: global.bike_draw_labels

        minor_road:
            bike: global.bike_draw_minor
            no_bike: global.no_bike_draw_minor
            # this is for the z18+ road labels
            labels-minor_road:
                bike_labels: global.bike_draw_labels
            # this is to show more generic labels at zoom 14
            # it would be nice to label these at 13, but the tiles don't have data for this
            bike-labels-z14:
                filter:
                    $zoom: [14]
                    is_bicycle_related: true
                draw:
                    text-blend-order:
                        priority: 59
                        visible: true
                        font:
                            fill: [0.536,0.556,0.581]
                            size: 9px
                            stroke: { color: global.text_stroke, width: 4px }

        path:
            bike: global.bike_draw_path
            no_bike: global.no_bike_draw_path
            paths:
                labels-path:
                    bike_labels: global.bike_draw_labels
            footway:
                bike: global.bike_draw_footway
                no_bike: global.no_bike_draw_footway
                labels-footpaths:
                    bike_labels: global.bike_draw_labels
            pedestrian:
                labels-pedestrian:
                    bike_labels: global.bike_draw_labels

        track:
            bike: global.bike_draw_track
            labels-track:
                bike_labels: global.bike_draw_labels

        steps:
            bike: global.bike_draw_steps

    # pois:
    #     filter:
    #         all:
    #             - not: { kind: [building,address,farm,apron,residential,commercial,industrial] }
    #             - $geometry: point
    #             # White list a few kinds to "always" show per the tile zoom inclusion, else test feature's min_zoom
    #             #- function() { return feature.min_zoom <= $zoom }
    #             - function() { if( feature.kind == 'attraction' || feature.kind == 'landmark' || feature.kind == 'hunting' || feature.kind == 'dive_centre' || feature.kind == 'gas_canister' || feature.kind == 'hunting' || feature.kind == 'fishing_area' || feature.kind == 'playground' || feature.kind == 'toilets' || feature.kind == 'cycle_barrier' ) { return true } else { return feature.min_zoom <= $zoom } }
    bike_pois:
        data: { source: mapzen, layer: pois }
        #visible: global.label_visible_poi_landuse
        filter:
            kind:
                - bicycle
                - cycle_barrier
                - bicycle_junction
                - bicycle_parking
                - bicycle_rental
                - bicycle_rental_station
                - cafe
                - drinking_water
                - pub
                - toilets

        draw:
            icons:
                visible: global.icon_visible_poi_landuse
                size: [[13, 18px], [16, 18px], [18, 22px]]
                sprite: function() { return 'bike_' + feature.kind; }
                sprite_default: generic
                interactive: global.interactive
                # todo: any of these needs a great priority to collide out the generic form (eg 20)
                priority: 20 #65 #function() { return (feature.min_zoom && Math.floor(feature.min_zoom * 1000)) || 65; }
                repeat_group: abc
                buffer: 7px
                text:
                    visible: global.text_visible_poi_landuse
                    text_source: global.ux_language_text_source
                    text_wrap: 18
                    max_lines: 3
                    font:
                        family: global.text_font_family
                        weight: 600
                        fill: [0.10,0.10,0.10]
                        size: [[13,10px],[14,10px],[18,11px]]
                        stroke: { color: global.text_stroke, width: 3 }

        bicycle:
            filter:
                all:
                    - kind: bicycle
                    - function() { return global.sdk_bike_overlay; }
            draw:
                icons:
                    priority: 43
        no-name:
            cycle_barrier:
                filter:
                    all:
                        - kind: cycle_barrier
                        - function() { return global.sdk_bike_overlay; }
                draw:
                    icons:
                        priority: 20
                        visible: true
            walking-or-bicycle_junction:
                bicycle_junction:
                    filter:
                        all:
                            - function() { return global.sdk_bike_overlay; }
                            #- $zoom: { min: 16 }
                            - kind: bicycle_junction
                            - ref: true
                            # - name: [true, false]
                            #- bicycle_network: [icn, ncn, rcn, lcn]
                    draw:
                        icons:
                            priority: 20
                            # you need to match any custom shield to the vector tile `network` values
                            sprite: function() { return ('sdk_shield-' + feature.ref.length + 'char'); }
                            # Size is specified below, and limited to 5 char in another filter
                            size: [[6,[27px,16px]],[13,[31px,18px]],[16,[36px,21px]]]
                            visible: true
                            color: [0.306,0.353,0.679]
                            text:
                                offset: [0px, -1px]
                                anchor: center
                                text_source: ref
                                visible: true
                                font:
                                    family: Montserrat
                                    fill: white
                                    weight: bold
                                    size: [[7,7px],[12,8px],[16,11px]]
                                    stroke: { width: 0px }
                    width_1char:
                        filter: function() { return (feature.ref.length === 1); }
                        draw:
                            icons:
                                size: [[6,[16px,16px]],[13,[18px,18px]],[16,[21px,21px]]]
                    width_2char:
                        filter: function() { return (feature.ref.length === 2); }
                        draw:
                            icons:
                                size: [[6,[21px,16px]],[13,[24px,18px]],[16,[28px,21px]]]
                    width_3char:
                        filter: function() { return (feature.ref.length === 3); }
                        draw:
                            icons:
                                size: [[6,[27px,16px]],[13,[31px,18px]],[16,[36px,21px]]]
                    width_4char:
                        filter: function() { return (feature.ref.length === 4); }
                        draw:
                            icons:
                                size: [[6,[32px,16px]],[13,[36px,18px]],[16,[41px,21px]]]
                    width_5char:
                        filter: function() { return (feature.ref.length === 5); }
                        draw:
                            icons:
                                size: [[6,[37px,16px]],[13,[41px,18px]],[16,[48px,21px]]]
                    # this is kinda a hack
                    width_longggggg:
                        filter: function() { return (feature.ref.length > 5); }
                        draw:
                            icons:
                                visible: false

global:
    sdk_bike_overlay: false          # should be false (true for dev)

    # COLORS
    bike_tier1_off_road_path_color: [0.085,0.650,0.405] # green
    bike_tier1_off_road_path_color_casing: [0.000,0.810,0.392]
    bike_tier1_off_road_path_color_lite: [0.554,0.865,0.554]
    bike_tier1_off_road_footway_color: [0.639,0.388,0.306]  # brown
    bike_tier1_off_road_footway_color_lite: [0.917,0.759,0.610]
    bike_tier1_off_road_track_color: [0.639,0.388,0.306]  # brown
    bike_tier1_off_road_track_color_lite: [0.917,0.759,0.610]
    bike_tier1a_label: [0.063,0.474,0.294] #green
    bike_tier1b_label: [0.559,0.338,0.269] #brown
    bike_tier2_on_road_protected_color: [0.930,0.460,0.167] # orange
    bike_tier2_on_road_protected_color_casing: [0.980,0.635,0.545]
    bike_tier2_on_road_protected_color_lite: [0.980,0.792,0.706]
    bike_tier2_label: [0.743,0.367,0.135]
    bike_tier3_on_road_not_protected_color: [0.273,0.332,0.780] #[0.361,0.416,0.800] # blue
    bike_tier3_on_road_not_protected_color_casing: [0.357,0.750,0.870]
    bike_tier3_on_road_not_protected_color_lite: [0.502,0.792,0.880] #[0.660,0.829,0.880]
    bike_tier3_label: [0.253,0.307,0.719]
    bike_prohibited_color: [0.930,0.679,0.721]
    bike_prohibited_color_lite: [1.000,1.000,1.000]
    left_right_lane: purple #[0.414,0.940,0.607]
    # regional_network_highlight: [0.973,1.000,0.318]
    regional_network_highlight: [1.000,1.000,0.549]
    no_bike_label: [0.740,0.540,0.572]
    no_bike_color_lite: [1.000,0.898,0.918]

    # FILTERS
    # labels
    bike_labels: |
        function() {
            if(feature.name) {
                name = feature.name + ' ';
            } else {
                name = '';
            }
            if( (feature.kind_detail == 'cycleway' && feature.cycleway == 'sidepath' || feature.cycleway == 'segregated') ||
                (feature.kind_detail == 'footway'  && feature.bicycle == 'yes' && feature.segregated == 'yes' )
            ) {
                return name + " (sidepath)";
            } else if( feature.bicycle == 'no' ) {
                return name + " (walk your bike)";
            } else if( feature.kind_detail == "cycleway" && feature.cycleway != 'sidepath' ) {
                return name + " (bike path)";
            } else if( feature.kind_detail == "footway" && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) {
                return name + " (bikes okay)";
            } else if( feature.kind_detail == "steps" && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) {
                return name + " (bikes okay)";
            } else if( feature.kind_detail == 'track' && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) {
                return name + " (bikes okay)";
            } else if( feature.kind_detail == 'pedestrian' ) {
                return name + " (bikes okay)";
            } else if( feature.kind == 'path' && (feature.bicycle == 'designated' || feature.bicycle == 'yes') ) {
                return name + " (bikes okay)";
            } else if( feature.cycleway && feature.oneway == 'yes' ) {
                return name + " (" + feature.cycleway + ")";
            } else if( feature.cycleway ) {
                return name + " (" + feature.cycleway + ")";
            } else if( feature.cycleway_left && feature.cycleway_right ){
                return name + " (" + feature.cycleway_left + " & " + feature.cycleway_right + ")";
            } else if( feature.cycleway_left ){
                return name + " (" + feature.cycleway_left + ")";
            } else if ( feature.cycleway_right ){
                return name + " (" + feature.cycleway_right + ")";
            } else {
                return name + " (bike route)";
            }
        }


    #
    # green
    bike_tier1_off_road_filter:
        all:
            - function() { return global.sdk_bike_overlay; }
        any:
            - { is_bicycle_related: true, kind_detail: [cycleway, path, pedestrian, steps] }
            - cycleway: [sidepath, track, opposite_track]
            - cycleway_left: [sidepath, track, opposite_track]
            - cycleway_right: [sidepath, track, opposite_track]
    casing_bike_tier1_off_road_track_filter_left:
        cycleway_left: [sidepath, track, opposite_track]
    casing_bike_tier1_off_road_track_filter_right:
        cycleway_right: [sidepath, track, opposite_track]
    bike_tier1_off_road_steps_filter:
        { is_bicycle_related: true, kind_detail: [steps] }
    #green, but brown (I know, right)
    bike_tier1_off_road_footway_filter:
        { is_bicycle_related: true, kind_detail: [footway] }

    # brown
    bike_tier1_off_road_track_filter:
        all:
            - function() { return global.sdk_bike_overlay; }
            - { is_bicycle_related: true, kind_detail: [track, footway] }

    # orange
    bike_tier2_on_road_protected_filter:
        all:
            - function() { return global.sdk_bike_overlay; }
        any:
            - cycleway: [lane, opposite, opposite_lane]
            - cycleway_left: [lane, opposite, opposite_lane]
            - cycleway_right: [lane, opposite, opposite_lane]
    casing_bike_tier2_on_road_protected_filter_left:
        cycleway_left: [sidepath, track, opposite_track]
    casing_bike_tier2_on_road_protected_filter_right:
        cycleway_right: [sidepath, track, opposite_track]

    # blue
    bike_tier3_on_road_not_protected_filter:
        all:
            - function() { return global.sdk_bike_overlay; }
            - is_bicycle_related: true
            - not:
                any:
                    - kind_detail: [cycleway, track, path, pedestrian, footway, steps]
                    - cycleway: [lane, opposite, opposite_lane, sidepath, track, opposite_track]
                    - cycleway_left: [lane, opposite, opposite_lane, sidepath, track, opposite_track]
                    - cycleway_right: [lane, opposite, opposite_lane, sidepath, track, opposite_track]
    casing_bike_tier3_on_road_not_protected_filter_left:
        cycleway_left: [shared_lane]
    casing_bike_tier3_on_road_not_protected_filter_right:
        cycleway_right: [shared_lane]

    # DRAW STYLES
    bike_draw_highway:
        bike_tier1_off_road:
            filter: global.bike_tier1_off_road_filter
            draw:
                lines:
                    color: [[8, global.bike_tier1_off_road_path_color], [10, global.bike_tier1_off_road_path_color], [11, global.bike_tier1_off_road_path_color_lite]]
                    outline:
                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_tier1_off_road_path_color]]
            casing: global.bike_draw_left_or_right_or_implied_tier1
            networks: global.bike_networks_highway
        bike_tier2_on_road_protected:
            filter: global.bike_tier2_on_road_protected_filter
            draw:
                lines:
                    color: [[8, global.bike_tier2_on_road_protected_color], [10, global.bike_tier2_on_road_protected_color], [11, global.bike_tier2_on_road_protected_color_lite]]
                    outline:
                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_tier2_on_road_protected_color]]
            casing: global.bike_draw_left_or_right_or_implied_tier2
            networks: global.bike_networks_highway
        bike_tier3_on_road_not_protected:
            filter: global.bike_tier3_on_road_not_protected_filter
            draw:
                lines:
                    color: [[8, global.bike_tier3_on_road_not_protected_color], [10, global.bike_tier3_on_road_not_protected_color], [11, global.bike_tier3_on_road_not_protected_color_lite]]
                    outline:
                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_tier3_on_road_not_protected_color]]
            casing: global.bike_draw_left_or_right_or_implied_tier3
            networks: global.bike_networks_highway
    bike_draw_trunk_primary:
        bike_tier1_off_road:
            filter: global.bike_tier1_off_road_filter
            draw:
                lines:
                    color: [[10, global.bike_tier1_off_road_path_color], [11, global.bike_tier1_off_road_path_color_lite]]
                    width: [[8, 1px], [10, 1.5px], [12, 1px], [14, 2.5px], [16, 6px], [17, 8.25px], [18, 10m]]
                    outline:
                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_tier1_off_road_path_color]]
                        width: [[8, 0.5px], [10, 0px], [12, 1.1px], [14, 1.25px], [16, 2.25px], [17, 3px], [18, 4px]]
            casing: global.bike_draw_left_or_right_or_implied_tier1
            networks: global.bike_networks_primary
        bike_tier2_on_road_protected:
            filter: global.bike_tier2_on_road_protected_filter
            draw:
                lines:
                    color: [[10, global.bike_tier2_on_road_protected_color], [11, global.bike_tier2_on_road_protected_color_lite]]
                    width: [[8, 1px], [10, 1.5px], [12, 1px], [14, 2.5px], [16, 6px], [17, 8.25px], [18, 10m]]
                    outline:
                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_tier2_on_road_protected_color]]
                        width: [[8, 0.5px], [10, 0px], [12, 1.1px], [14, 1.25px], [16, 2.25px], [17, 3px], [18, 4px]]
            casing: global.bike_draw_left_or_right_or_implied_tier2
            networks: global.bike_networks_primary
        bike_tier3_on_road_not_protected:
            filter: global.bike_tier3_on_road_not_protected_filter
            draw:
                lines:
                    color: [[10, global.bike_tier3_on_road_not_protected_color], [11, global.bike_tier3_on_road_not_protected_color_lite]]
                    width: [[8, 1px], [10, 1.5px], [12, 1px], [14, 2.5px], [16, 6px], [17, 8.25px], [18, 10m]]
                    outline:
                        color: [[8, [0.969,0.969,0.969]], [10, [0.969,0.969,0.969]], [11, global.bike_tier3_on_road_not_protected_color]]
                        width: [[8, 0.5px], [10, 0px], [12, 1.1px], [14, 1.25px], [16, 2.25px], [17, 3px], [18, 4px]]
            casing: global.bike_draw_left_or_right_or_implied_tier3
            networks: global.bike_networks_primary
    bike_draw_secondary:
        bike_tier1_off_road:
            filter: global.bike_tier1_off_road_filter
            draw:
                lines:
                    color: global.bike_tier1_off_road_path_color_lite
                    outline:
                        color: [[9, [0.906,0.906,0.906]], [10, global.bike_tier1_off_road_path_color]]
            casing: global.bike_draw_left_or_right_or_implied_tier1
            networks: global.bike_networks_secondary
        bike_tier2_on_road_protected:
            filter: global.bike_tier2_on_road_protected_filter
            draw:
                lines:
                    color: global.bike_tier2_on_road_protected_color_lite
                    outline:
                        color: [[9, [0.906,0.906,0.906]], [10, global.bike_tier2_on_road_protected_color]]
            casing: global.bike_draw_left_or_right_or_implied_tier2
            networks: global.bike_networks_secondary
        bike_tier3_on_road_not_protected:
            filter: global.bike_tier3_on_road_not_protected_filter
            draw:
                lines:
                    color: global.bike_tier3_on_road_not_protected_color_lite
                    outline:
                        color: [[9, [0.906,0.906,0.906]], [10, global.bike_tier3_on_road_not_protected_color]]
            casing: global.bike_draw_left_or_right_or_implied_tier3
            networks: global.bike_networks_secondary

    bike_draw_tertiary:
        bike_tier1_off_road:
            filter: global.bike_tier1_off_road_filter
            draw:
                lines:
                    color: global.bike_tier1_off_road_path_color_lite
                    outline:
                        color: [[11, [0.847,0.822,0.826]], [12, global.bike_tier1_off_road_path_color]]
                        width: [[10, 0px], [11, 0px], [12, 0.5px], [14, 1px], [16, 2px], [17, 2px], [18, 4px]]
            casing: global.bike_draw_left_or_right_or_implied_tier1
            networks: global.bike_networks_tertiary
        bike_tier2_on_road_protected:
            filter: global.bike_tier2_on_road_protected_filter
            draw:
                lines:
                    color: global.bike_tier2_on_road_protected_color_lite
                    outline:
                        color: [[11, [0.847,0.822,0.826]], [12, global.bike_tier2_on_road_protected_color]]
                        width: [[10, 0px], [11, 0px], [12, 0.5px], [14, 1px], [16, 2px], [17, 2px], [18, 4px]]
            casing: global.bike_draw_left_or_right_or_implied_tier2
            networks: global.bike_networks_tertiary
        bike_tier3_on_road_not_protected:
            filter: global.bike_tier3_on_road_not_protected_filter
            draw:
                lines:
                    color: global.bike_tier3_on_road_not_protected_color_lite
                    outline:
                        color: [[11, [0.847,0.822,0.826]], [12, global.bike_tier3_on_road_not_protected_color]]
                        width: [[10, 0px], [11, 0px], [12, 0.5px], [14, 1px], [16, 2px], [17, 2px], [18, 4px]]
            casing: global.bike_draw_left_or_right_or_implied_tier3
            networks: global.bike_networks_tertiary

    bike_draw_minor:
        bike_tier1_off_road:
            filter: global.bike_tier1_off_road_filter
            draw:
                lines:
                    color: [[12, global.bike_tier1_off_road_path_color], [13, global.bike_tier1_off_road_path_color_lite]]
                    width: [[10, 0px], [12, 1px], [13, 0.15px], [14, 1px], [16, 3px], [18, 9m]]
                    outline:
                        color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier1_off_road_path_color]]
                        width: [[11, 0px], [12, 0px], [13, 0.5px], [14, 1px], [16, 1.5px], [17, 2px], [18, 3px]]
            casing: global.bike_draw_left_or_right_or_implied_tier1
            networks: global.bike_networks_minor
        bike_tier2_on_road_protected:
            filter: global.bike_tier2_on_road_protected_filter
            draw:
                lines:
                    color: [[12, global.bike_tier2_on_road_protected_color], [13, global.bike_tier2_on_road_protected_color_lite]]
                    width: [[11, 0px], [12, 1px], [13, 0.15px], [14, 1px], [16, 3px], [18, 9m]]
                    outline:
                        color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier2_on_road_protected_color]]
                        width: [[11, 0px], [12, 0px], [13, 0.5px], [14, 1px], [16, 1.5px], [17, 2px], [18, 3px]]
            early:
                filter:
                    $zoom: [13]
                draw:
                    lines:
                        order: 360

            casing: global.bike_draw_left_or_right_or_implied_tier2
            networks: global.bike_networks_minor
        bike_tier3_on_road_not_protected:
            filter: global.bike_tier3_on_road_not_protected_filter
            draw:
                lines:
                    color: [[12, global.bike_tier3_on_road_not_protected_color], [13, global.bike_tier3_on_road_not_protected_color_lite]]
                    width: [[11, 0px], [12, 1px], [13, 0.15px], [14, 1px], [16, 3px], [18, 9m]]
                    outline:
                        color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier3_on_road_not_protected_color]]
                        width: [[11, 0px], [12, 0px], [13, 0.5px], [14, 1px], [16, 1.5px], [17, 2px], [18, 3px]]
            casing: global.bike_draw_left_or_right_or_implied_tier3
            networks: global.bike_networks_minor

    no_bike_draw_minor:
        filter:
            bicycle: no
        draw:
            lines:
                color: [[12, global.bike_prohibited_color], [13, global.bike_prohibited_color_lite]]
                width: [[11, 0px], [12, 0.75px], [13, 0.15px], [14, 1px], [16, 3px], [18, 9m]]
                outline:
                    style: no_bike_dash
                    color: [[12, [0.900,0.900,0.900]], [13, global.bike_prohibited_color]]
                    width: [[11, 0px], [12, 0px], [13, 0.25px], [14, 1px], [16, 1.5px], [17, 2px], [18, 3px]]

    bike_draw_path:
        # thicken the widths
        bike_tier1_off_road:
            filter: global.bike_tier1_off_road_filter
            draw:
                lines:
                    color: [[12, global.bike_tier1_off_road_path_color], [13, global.bike_tier1_off_road_path_color], [14, global.bike_tier1_off_road_path_color_lite]]
                    width: [[12, 1px], [13, 1.1px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
                    outline:
                        color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier1_off_road_path_color]]
                        width: [[13, 0px], [14, 0.65px], [15, 1px], [17, 2px], [18, 3px]]
            # footway:
            #     filter:
            #         kind_detail: footway
            #     draw:
            #         lines:
            #             color: pink
            #             outline:
            #                 color: red
            networks: global.bike_networks_path
        bike_tier2_on_road_protected:
            filter: global.bike_tier2_on_road_protected_filter
            draw:
                lines:
                    color: [[12, global.bike_tier2_on_road_protected_color], [13, global.bike_tier2_on_road_protected_color], [14, global.bike_tier2_on_road_protected_color_lite]]
                    width: [[12, 1.25px], [13, 1.25px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
                    outline:
                        color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier2_on_road_protected_color]]
                        width: [[13, 0px], [14, 0.6px], [15, 1px], [17, 2px], [18, 3px]]
            networks: global.bike_networks_path
        bike_tier3_on_road_not_protected:
            filter: global.bike_tier3_on_road_not_protected_filter
            draw:
                lines:
                    color: [[12, global.bike_tier3_on_road_not_protected_color], [13, global.bike_tier3_on_road_not_protected_color], [14, global.bike_tier3_on_road_not_protected_color_lite]]
                    width: [[12, 1.25px], [13, 1.25px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
                    outline:
                        color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier3_on_road_not_protected_color]]
                        width: [[13, 0px], [14, 0.6px], [15, 1px], [17, 2px], [18, 3px]]
            networks: global.bike_networks_path

    bike_draw_footway:
        # todo: match the zoom stops from bike_tier1_off_road in this path section
        footway:
            filter: global.bike_tier1_off_road_footway_filter
            draw:
                lines:
                    # footway is narrower than default
                    color: global.bike_tier1_off_road_footway_color_lite
                    width: [[13, 0.35px], [14, 0.5px], [15, 1px], [17, 2.5m]]
                    outline:
                        # casing for footway starts at  z16
                        color: global.bike_tier1_off_road_footway_color
                        width: [[13, 0px], [14, 0.4px], [15, 1px], [17, 2px], [18, 3px]]
        sidewalk-crossing:
            bike:
                filter:
                    is_bicycle_related: true
                    not: { kind_detail: footway }
                draw:
                    lines:
                        outline:
                            color: global.bike_tier1_off_road_path_color

    no_bike_draw_path:
        filter:
            bicycle: no
        draw:
            lines:
                color: [[12, global.bike_prohibited_color], [13, global.bike_prohibited_color], [14, global.bike_prohibited_color_lite]]
                width: [[12, 0.5px], [13, 0.5px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
                outline:
                    style: no_bike_dash
                    color: [[12, [0.900,0.900,0.900]], [13, global.bike_prohibited_color]]
                    width: [[13, 0px], [14, 0.6px], [15, 1px], [17, 2px], [18, 3px]]

    no_bike_draw_footway:
        filter:
            bicycle: no
        draw:
            lines:
                # footway is narrower than default
                width: [[13, 0.25px], [14, 0.5px], [15, 1px], [17, 2.5m]]
                outline:
                    # casing for footway starts at  z16
                    style: no_bike_dash
                    width: [[14, 0px], [15, 0px], [16, 1px], [17, 1px], [18, 3px]]

    bike_draw_track:
        bike_tier1_off_road:
            filter: global.bike_tier1_off_road_track_filter
            draw:
                lines:
                    color: [[12, global.bike_tier1_off_road_track_color], [13, global.bike_tier1_off_road_track_color], [14, global.bike_tier1_off_road_track_color_lite]]
                    width: [[12, 0.75px], [13, 0.75px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
                    outline:
                        color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier1_off_road_track_color]]
                        width: [[13, 0px], [14, 0.6px], [15, 1px], [17, 2px], [18, 3px]]
            networks: global.bike_networks_track
        # bike_tier2_on_road_protected:
        #     filter: global.bike_tier2_on_road_protected_filter
        #     draw:
        #         lines:
        #             color: [[12, global.bike_tier1_off_road_track_color], [13, global.bike_tier1_off_road_track_color], [14, global.bike_tier1_off_road_track_color_lite]]
        #             width: [[12, 0.75px], [13, 0.75px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
        #             outline:
        #                 color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier1_off_road_track_color]]
        #                 width: [[13, 0px], [14, 0.6px], [15, 1px], [17, 2px], [18, 3px]]
        #     networks: global.bike_networks_track
        # bike_tier3_on_road_not_protected:
        #     filter: global.bike_tier3_on_road_not_protected_filter
        #     draw:
        #         lines:
        #             color: [[12, global.bike_tier1_off_road_track_color], [13, global.bike_tier1_off_road_track_color], [14, global.bike_tier1_off_road_track_color_lite]]
        #             width: [[12, 0.75px], [13, 0.75px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
        #             outline:
        #                 color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier1_off_road_track_color]]
        #                 width: [[13, 0px], [14, 0.6px], [15, 1px], [17, 2px], [18, 3px]]
        #     networks: global.bike_networks_track

    bike_draw_steps:
        bike_tier1_off_road:
            filter: global.bike_tier1_off_road_steps_filter
            draw:
                dashed_steps:
                    color: [0.633,0.988,0.633] #global.bike_tier1_off_road_path_color_lite
                    width: [[15, 0.6], [16, 1px], [17, 2.5m]]
        # bike_tier2_on_road_protected:
        #     filter: global.bike_tier2_on_road_protected_filter
        #     draw:
        #         dashed_steps:
        #             color: global.bike_tier2_on_road_protected_filter_color_lite
        #             width: [[15, 0.6], [16, 1px], [17, 2.5m]]
        # bike_tier3_on_road_not_protected:
        #     filter: global.bike_tier3_on_road_not_protected_filter
        #     draw:
        #         dashed_steps:
        #             color: global.bike_tier3_on_road_not_protected_filter_color_lite
        #             width: [[15, 0.6], [16, 1px], [17, 2.5m]]

    bike_draw_left_or_right_or_implied_tier1:
        filter:
            $zoom: { min: 18 }
        draw:
            casing_both:
                visible: true
                color: global.bike_tier1_off_road_path_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
            casing_left:
                visible: false
                color: global.bike_tier1_off_road_path_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
            casing_right:
                visible: false
                color: global.bike_tier1_off_road_path_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
        special_casing: global.casing_bike_draw_on_off

    bike_draw_left_or_right_or_implied_tier2:
        filter:
            $zoom: { min: 18 }
        draw:
            casing_both:
                visible: true
                color: global.bike_tier2_on_road_protected_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
            casing_left:
                visible: false
                color: global.bike_tier2_on_road_protected_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
            casing_right:
                visible: false
                color: global.bike_tier2_on_road_protected_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
        special_casing: global.casing_bike_draw_on_off

    bike_draw_left_or_right_or_implied_tier3:
        filter:
            $zoom: { min: 18 }
        draw:
            casing_both:
                visible: true
                color: global.bike_tier3_on_road_not_protected_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
            casing_left:
                visible: false
                color: global.bike_tier3_on_road_not_protected_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
            casing_right:
                visible: false
                color: global.bike_tier3_on_road_not_protected_color_casing
                order: function() { return feature.sort_rank + 1; }
                width: [[13, 0px], [14, 1px], [16, 2px], [17, 3.5px], [18, 9m], [19, 9m]]
        special_casing: global.casing_bike_draw_on_off

    casing_bike_draw_on_off:
        filter:
            - any:
                - cycleway_left: true
                - cycleway_right: true
                - { oneway: yes, cycleway: true }
                - { oneway: yes, kind_detail: true }
        draw:
            casing_both:
                visible: false
            casing_left:
                visible: false
            casing_right:
                visible: true
        left:
            filter:
                any:
                    - cycleway_left: true
                    - cycleway: opposite
            draw:
                casing_left:
                    visible: true
                casing_right:
                    visible: false
            and_right:
                filter:
                    all:
                        - cycleway_left: true
                        - cycleway_right: true
                draw:
                    casing_left:
                        visible: true
                    casing_right:
                        visible: true
                tier1_left:
                    filter: global.casing_bike_tier1_off_road_track_filter_left
                    draw:
                        casing_left:
                            color: global.bike_tier1_off_road_path_color_casing
                tier1_right:
                    filter: global.casing_bike_tier1_off_road_track_filter_right
                    draw:
                        casing_right:
                            color: global.bike_tier1_off_road_path_color_casing
                tier2_left:
                    filter: global.casing_bike_tier2_on_road_protected_filter_left
                    draw:
                        casing_left:
                            color: global.bike_tier2_on_road_protected_color_casing
                tier2_right:
                    filter: global.casing_bike_tier2_on_road_protected_filter_right
                    draw:
                        casing_right:
                            color: global.bike_tier2_on_road_protected_color_casing
                tier3_left:
                    filter: global.casing_bike_tier3_on_road_not_protected_filter_left
                    draw:
                        casing_left:
                            color: global.bike_tier3_on_road_not_protected_color_casing
                tier3_right:
                    filter: global.casing_bike_tier3_on_road_not_protected_filter_right
                    draw:
                        casing_right:
                            color: global.bike_tier3_on_road_not_protected_color_casing

    bike_draw_labels:
        z18:
            filter:
                $zoom: { min: 18 }
            bike_tier1a:
                filter: global.bike_tier1_off_road_filter
                draw:
                    text-blend-order:
                        text_source: global.bike_labels
                        font:
                            fill: global.bike_tier1a_label
                            weight: 600
                            #size: 10px
                            stroke: { color: global.bike_tier1_off_road_path_color_lite }
            bike_tier1b:
                filter: global.bike_tier1_off_road_track_filter
                draw:
                    text-blend-order:
                        text_source: global.bike_labels
                        font:
                            fill: global.bike_tier1b_label
                            weight: 600
                            #size: 10px
                            stroke: { color: global.bike_tier1_off_road_track_color_lite }
            bike_tier2:
                filter: global.bike_tier2_on_road_protected_filter
                draw:
                    text-blend-order:
                        text_source: global.bike_labels
                        font:
                            fill: global.bike_tier2_label
                            weight: 600
                            #size: 10px
                            stroke: { color: global.bike_tier2_on_road_protected_color_lite }
            bike_tier3:
                filter: global.bike_tier3_on_road_not_protected_filter
                draw:
                    text-blend-order:
                        text_source: global.bike_labels
                        font:
                            fill: global.bike_tier3_label
                            weight: 600
                            #size: 10px
                            stroke: { color: global.bike_tier3_on_road_not_protected_color_lite }
            no_bike:
                filter:
                    bicycle: no
                draw:
                    text-blend-order:
                        text_source: global.bike_labels
                        font:
                            fill: global.no_bike_label
                            weight: 600
                            #size: 10px
                            stroke: { color: global.no_bike_color_lite }

    bike_networks_highway:
        filter:
            bicycle_network: true
        draw:
            highlight:
                base: lines
                order: function() { return feature.sort_rank - 100; }
                color: global.regional_network_highlight
                width: [[10, 0px], [11, 3px], [12, 10px], [13, 12px], [15, 18px], [17, 30px], [19, 60px], [20, 96px]]
        local_network:
            filter: { bicycle_network: lcn, $zoom: { max: 15 } }
            draw:
                highlight:
                    visible: false

    bike_networks_primary:
        filter:
            bicycle_network: true
        draw:
            highlight:
                base: lines
                order: function() { return feature.sort_rank - 100; }
                color: global.regional_network_highlight
                width: [[9, 6px], [10, 7px], [11, 8px], [12, 11px], [13, 13px], [15, 15px], [17, 24px], [19, 60px], [20, 96px]]
        local_network:
            filter: { bicycle_network: lcn, $zoom: { max: 15 } }
            draw:
                highlight:
                    visible: false

    bike_networks_secondary:
        filter:
            bicycle_network: true
        draw:
            highlight:
                base: lines
                order: function() { return feature.sort_rank - 100; }
                color: global.regional_network_highlight
                width: [[10, 6px], [11, 7px], [12, 10px], [13, 12px], [15, 15px], [17, 24px], [19, 60px], [20, 96px]]
        local_network:
            filter: { bicycle_network: lcn, $zoom: { max: 15 } }
            draw:
                highlight:
                    visible: false

    bike_networks_tertiary:
        filter:
            bicycle_network: true
        draw:
            highlight:
                base: lines
                order: function() { return feature.sort_rank - 30; }
                color: global.regional_network_highlight
                width: [[11, 0px], [12, 5px], [13, 7px], [15, 13px], [17, 18px], [19, 50px], [20, 90px]]
        local_network:
            filter: { bicycle_network: lcn, $zoom: { max: 15 } }
            draw:
                highlight:
                    visible: false

    bike_networks_minor:
        filter:
            bicycle_network: true
        draw:
            highlight:
                base: lines
                order: function() { return feature.sort_rank - 20; }
                color: global.regional_network_highlight
                width: [[11, 0px], [12, 5px], [13, 6px], [15, 11px], [17, 18px], [19, 50px], [20, 90px]]
        local_network:
            filter: { bicycle_network: lcn, $zoom: { max: 15 } }
            draw:
                highlight:
                    visible: false

    bike_networks_path:
        filter:
            bicycle_network: true
        draw:
            highlight:
                base: lines
                order: function() { return feature.sort_rank - 3; }
                color: global.regional_network_highlight
                width: [[11, 0px], [12, 5px], [15, 10px], [17, 13px], [19, 30px]]
        local_network:
            filter: { bicycle_network: lcn }
            draw:
                lines:
                    color: [[12, global.bike_tier1_off_road_path_color], [13, global.bike_tier1_off_road_path_color], [14, global.bike_tier1_off_road_path_color_lite]]
                    width: [[12, 1.25px], [13, 2px], [14, 0.15px], [15, 1.5px], [17, 2.5m]]
                    outline:
                        color: [[12, [0.900,0.900,0.900]], [13, global.bike_tier1_off_road_path_color]]
                        width: [[13, 0px], [14, 1px], [15, 1px], [17, 2px], [18, 3px]]
            highlight-later:
                filter: { $zoom: { max: 15 } }
                draw:
                    highlight:
                        visible: false

    bike_networks_track:
        filter:
            bicycle_network: true
        draw:
            highlight:
                base: lines
                order: function() { return feature.sort_rank - 3; }
                color: global.regional_network_highlight
                width: [[11, 0px], [12, 5px], [15, 10px], [17, 13px], [19, 30px]]
        local_network:
            filter: { bicycle_network: lcn, $zoom: { max: 15 } }
            draw:
                highlight:
                    visible: false


styles:
    no_bike_dash:
        base: lines
        dash: [1.00, 0.75]
        dash_background_color: [1.000,0.900,0.917]
    oneway:
        base: points
        texture: oneway
    casing_both:
        base: lines
        texcoords: true
        shaders:
            uniforms:
                OFFSET: 0.7
            blocks:
                color: |
                    vec2 st = v_texcoord.xy;
                    if (st.x < OFFSET && 1. - st.x < OFFSET) {
                        discard;
                    }
    casing_left:
        mix: casing_right
        shaders:
            uniforms:
                FLIP: true
    casing_right:
        base: lines
        texcoords: true
        shaders:
            uniforms:
                FLIP: false
                OFFSET: 0.7
            blocks:
                color: |
                    vec2 st = v_texcoord.xy;
                    if (FLIP) {
                        st.x = 1. - st.x;
                    }

                    if (st.x < OFFSET) {
                        discard;
                    }